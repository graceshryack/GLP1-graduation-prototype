---
description: ProtoFlow - Maintain living product documentation as the prototype evolves
globs: ["**"]
alwaysApply: true
---

# ProtoFlow Living Documentation Protocol

You are working on a prototype that maintains living documentation in the `docs/` directory and a machine-readable manifest at `protoflow-manifest.json`. These are **always kept in sync with the code**.

## Documents You Maintain

| File | Purpose | Update When... |
|------|---------|---------------|
| `docs/PRODUCT.md` | Product spec | Features added/changed/removed |
| `docs/ARCHITECTURE.md` | Technical architecture | New services, data model changes |
| `docs/SCREENS.md` | Screen registry | Screens added/modified/removed |
| `docs/FLOWS.md` | User journey definitions | Navigation changes, new paths |
| `docs/DECISIONS.md` | Decision log | Significant decisions made |
| `protoflow-manifest.json` | Machine-readable screen + flow data | Whenever SCREENS.md or FLOWS.md changes |

## Keeping protoflow-manifest.json in Sync

When you update SCREENS.md or FLOWS.md, also update `protoflow-manifest.json`:

- Each screen in SCREENS.md should have a corresponding entry in the manifest's `screens` array with: `id`, `name`, `purpose`, `sourceFile`
- Each flow in FLOWS.md should have a corresponding entry in the manifest's `flows` array with: `name`, `steps` (array of `{screenId, action, annotation}`)
- Screen IDs must match exactly between SCREENS.md headings, FLOWS.md references, manifest entries, and snapshot test names

## Snapshot Tests

This project uses swift-snapshot-testing to capture screenshots in CI. When you add or rename a screen:

1. Add a matching snapshot test in the ProtoFlowCapture test target
2. Use the screen's ID as the test function name: `func test_ScreenId()`
3. The CI pipeline matches screenshot filenames to manifest screen IDs

## Generating a Figma UX Flow

When the user asks to "generate a UX flow", "create a Figma flow", "export to Figma", or similar:
1. Make sure `protoflow-manifest.json` is up to date
2. Tell the user to push to GitHub â€” the CI workflow will capture screenshots, build the payload, and upload to ProtoFlow
3. Or fetch https://protoflow-app.netlify.app/api/kickstart/generate and follow every instruction for a local run
